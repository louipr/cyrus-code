# Draw.io Application Context
#
# Shared context for all Draw.io recordings.
# This describes the application state and how to interact with it.

app: diagram-webview
description: Draw.io editor embedded in Electron webview

# How to access Draw.io in tests
access:
  selector: '[data-testid="diagram-webview"]'
  method: webview.executeJavaScript()

# Key global variables in Draw.io context
globals:
  __cyrusEditorUi: EditorUi instance captured by preload hook
  __cyrusHooked: Boolean indicating hook was installed
  editorUi: Native Draw.io EditorUi (embed mode only)
  App: Draw.io application class

# Important selectors
selectors:
  container: '.geDiagramContainer'
  menubar: '.geMenubar'
  menuItem: '.geItem'
  popupMenu: '.mxPopupMenu'
  dialog: '.geDialog'

# How the EditorUi hook works
hook_mechanism: |
  The preload script (drawio-preload.ts) injects a hook that wraps App.main().
  When Draw.io calls App.main(callback), we intercept the callback to capture
  the EditorUi instance passed to it. This gives us access to:
  - editorUi.editor.graph - the mxGraph instance
  - editorUi.editor.exportToCanvas() - native PNG export
  - editorUi.actions - menu action handlers
